name: Create Jira Issue on Commit

on:
  push:
    branches:
      - main

jobs:
  create-jira-issue:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      - name: Extract Commit Message
        run: |
          echo "COMMIT_MSG=${{ github.event.head_commit.message }}" >> $GITHUB_ENV

      - name: Debug Jira Secrets
        run: |
          echo "===== DEBUG: Jira Secrets ====="
          echo "JIRA_SITE       = '${{ secrets.JIRA_SITE }}'"
          echo "JIRA_EMAIL      = '${{ secrets.JIRA_EMAIL }}'"
          echo "JIRA_API_TOKEN  = '******** (hidden)'"
          echo "Full Jira URL   = https://${{ secrets.JIRA_SITE }}/rest/api/3/issue"
          echo "================================"

      - name: Create Jira Task via REST API
        run: |
          echo "Creating Jira Issue..."
          echo "Commit Message = $COMMIT_MSG"
          echo "POST URL = https://${{ secrets.JIRA_SITE }}/rest/api/3/issue"

          curl -X POST "https://${{ secrets.JIRA_SITE }}/rest/api/3/issue" \
            -H "Content-Type: application/json" \
            -u "${{ secrets.JIRA_EMAIL }}:${{ secrets.JIRA_API_TOKEN }}" \
            --data "{
              \"fields\": {
                \"project\": { \"key\": \"SCRUM\" },
                \"summary\": \"Auto Issue: $COMMIT_MSG\",
                \"description\": \"Automatically created from GitHub commit.\",
                \"issuetype\": { \"name\": \"Task\" }
              }
            }"
