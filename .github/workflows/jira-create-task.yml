name: Create Jira Task on Commit

on:
  push:
    branches:
      - main      # or any branch you want
      - develop

jobs:
  create-jira-task:
    runs-on: ubuntu-latest

    steps:
      - name: Extract Commit Message
        run: echo "COMMIT_MSG=$(echo '${{ github.event.head_commit.message }}')" >> $GITHUB_ENV

      - name: Create Jira Task via REST API
        run: |
          curl -X POST \
            -H "Content-Type: application/json" \
            -u "${{ secrets.JIRA_EMAIL }}:${{ secrets.JIRA_API_TOKEN }}" \
            --data "{
              \"fields\": {
                \"project\": { \"key\": \"ABC\" },
                \"summary\": \"Auto-created from GitHub commit: $COMMIT_MSG\",
                \"description\": \"This task was automatically generated when a commit was pushed to GitHub.\",
                \"issuetype\": { \"name\": \"Task\" }
              }
            }" \
            "https://${{ secrets.JIRA_SITE }}/rest/api/3/issue"
